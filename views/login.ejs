<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Task Recorder - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --indigo: #4f46e5;
        --indigo-dark: #3730a3;
        --indigo-light: #818cf8;
        --violet: #7c3aed;
        --emerald: #10b981;
        --rose: #f43f5e;
        --body-bg: #f0f0f7;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: 'Sora', sans-serif;
        background: var(--body-bg);
        background-image:
          radial-gradient(ellipse at 20% 0%, rgba(79, 70, 229, 0.06) 0%, transparent 60%),
          radial-gradient(ellipse at 80% 100%, rgba(124, 58, 237, 0.05) 0%, transparent 60%);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
      }

      .login-card {
        background: #fff;
        border-radius: 20px;
        border: 1px solid rgba(0, 0, 0, 0.06);
        box-shadow:
          0 4px 24px rgba(79, 70, 229, 0.08),
          0 1px 3px rgba(0, 0, 0, 0.04);
        overflow: hidden;
        width: 100%;
        max-width: 420px;
      }

      .card-header {
        background: linear-gradient(135deg, #0f0e17, #1e1b4b);
        padding: 36px 32px 32px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .card-header::before {
        content: '';
        position: absolute;
        top: -40px;
        left: -40px;
        width: 160px;
        height: 160px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(79, 70, 229, 0.25) 0%, transparent 70%);
      }

      .card-header::after {
        content: '';
        position: absolute;
        bottom: -30px;
        right: -20px;
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(124, 58, 237, 0.2) 0%, transparent 70%);
      }

      .brand-logo {
        width: 56px;
        height: 56px;
        border-radius: 16px;
        background: linear-gradient(135deg, var(--indigo), var(--violet));
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 16px;
        position: relative;
        z-index: 1;
        box-shadow: 0 8px 24px rgba(79, 70, 229, 0.4);
      }

      .card-header h1 {
        font-size: 1.375rem;
        font-weight: 800;
        color: #fff;
        position: relative;
        z-index: 1;
        margin-bottom: 4px;
      }

      .card-header p {
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.4);
        position: relative;
        z-index: 1;
      }

      .card-body {
        padding: 28px 32px 32px;
      }

      /* Error alert */
      .alert-error {
        padding: 12px 14px;
        border-radius: 10px;
        background: rgba(244, 63, 94, 0.08);
        border: 1px solid rgba(244, 63, 94, 0.2);
        color: #9f1239;
        font-size: 0.82rem;
        display: flex;
        align-items: flex-start;
        gap: 8px;
        margin-bottom: 20px;
      }

      /* Field label */
      .field-label {
        display: block;
        font-size: 0.78rem;
        font-weight: 600;
        color: #475569;
        margin-bottom: 6px;
        letter-spacing: 0.01em;
      }

      /* User ID field compound input */
      .userid-wrapper {
        display: flex;
        border-radius: 10px;
        border: 1.5px solid #e2e8f0;
        overflow: hidden;
        transition:
          border-color 0.2s,
          box-shadow 0.2s;
      }
      .userid-wrapper:focus-within {
        border-color: var(--indigo);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }
      .userid-input {
        flex: 1;
        padding: 9px 12px;
        outline: none;
        font-size: 0.85rem;
        font-family: 'JetBrains Mono', monospace;
        color: #0f172a;
        background: transparent;
        border: none;
        text-transform: uppercase;
        min-width: 0;
      }
      .userid-suffix {
        padding: 9px 12px;
        background: #f8fafc;
        border-left: 1.5px solid #e2e8f0;
        color: #94a3b8;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        white-space: nowrap;
        flex-shrink: 0;
        font-family: 'Sora', sans-serif;
      }

      /* Password field */
      .password-wrapper {
        position: relative;
      }
      .field-input {
        width: 100%;
        padding: 9px 40px 9px 12px;
        border: 1.5px solid #e2e8f0;
        border-radius: 10px;
        font-size: 0.85rem;
        font-family: 'Sora', sans-serif;
        outline: none;
        transition:
          border-color 0.2s,
          box-shadow 0.2s;
        color: #0f172a;
        background: #fff;
      }
      .field-input:focus {
        border-color: var(--indigo);
        box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
      }
      .eye-btn {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: #94a3b8;
        display: flex;
        align-items: center;
        transition: color 0.15s;
        padding: 2px;
      }
      .eye-btn:hover {
        color: #475569;
      }

      /* Submit button */
      .btn-primary {
        width: 100%;
        padding: 11px 20px;
        background: linear-gradient(135deg, var(--indigo), var(--violet));
        color: #fff;
        border: none;
        border-radius: 10px;
        font-size: 0.9rem;
        font-weight: 600;
        font-family: 'Sora', sans-serif;
        cursor: pointer;
        transition:
          opacity 0.15s,
          box-shadow 0.15s,
          transform 0.15s;
        box-shadow: 0 2px 8px rgba(79, 70, 229, 0.35);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        margin-top: 24px;
      }
      .btn-primary:hover:not(:disabled) {
        opacity: 0.92;
        box-shadow: 0 4px 16px rgba(79, 70, 229, 0.45);
        transform: translateY(-1px);
      }
      .btn-primary:disabled {
        opacity: 0.7;
        cursor: not-allowed;
        transform: none;
      }

      /* Divider between fields */
      .form-group {
        margin-bottom: 18px;
      }
      .form-group:last-of-type {
        margin-bottom: 0;
      }

      /* Footer */
      .page-footer {
        text-align: center;
        font-size: 0.73rem;
        color: #94a3b8;
        margin-top: 24px;
      }

      /* Spinner */
      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      .animate-spin {
        animation: spin 1s linear infinite;
      }
    </style>
  </head>
  <body>
    <div style="width: 100%; max-width: 420px">
      <!-- Login Card -->
      <div class="login-card">
        <!-- Header -->
        <div class="card-header">
          <div class="brand-logo">
            <svg
              class="w-6 h-6 text-white"
              style="width: 26px; height: 26px"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
              />
            </svg>
          </div>
          <h1>Task Recorder</h1>
          <p>Sign in to your account</p>
        </div>

        <!-- Body -->
        <div class="card-body">
          <!-- Error Message -->
          <div
            id="errorMessage"
            class="alert-error"
            <% if (!deactivated && !sessionExpired) { %> style="display:none;" <% } %>
          >
            <svg
              class="flex-shrink-0"
              style="width: 16px; height: 16px; margin-top: 1px"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                clip-rule="evenodd"
              />
            </svg>
            <span id="errorText">
              <% if (deactivated) { %> Your account has been deactivated. Please contact your
              administrator. <% } else if (sessionExpired) { %> You were logged in from another
              device. Please sign in again. <% } %>
            </span>
          </div>

          <form id="loginForm">
            <!-- User ID -->
            <div class="form-group">
              <label for="userId" class="field-label">User ID</label>
              <div class="userid-wrapper">
                <input
                  type="text"
                  id="userId"
                  name="userId"
                  placeholder="EMP001"
                  class="userid-input"
                  required
                  autocomplete="username"
                />
                <span class="userid-suffix">@conspicuous.com</span>
              </div>
            </div>

            <!-- Password -->
            <div class="form-group">
              <label for="password" class="field-label">Password</label>
              <div class="password-wrapper">
                <input
                  type="password"
                  id="password"
                  name="password"
                  placeholder="••••••••"
                  class="field-input"
                  required
                  autocomplete="current-password"
                />
                <button type="button" id="togglePassword" class="eye-btn">
                  <svg
                    id="eyeIcon"
                    style="width: 18px; height: 18px"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                    />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Submit -->
            <button type="submit" id="submitBtn" class="btn-primary">
              <svg
                style="width: 16px; height: 16px"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"
                />
              </svg>
              Sign In
            </button>
          </form>
        </div>
      </div>

      <!-- Footer -->
      <p class="page-footer">© 2024 Task Recorder. All rights reserved.</p>
    </div>

    <script>
      // Auto uppercase userId input
      const userIdInput = document.getElementById('userId');
      userIdInput.addEventListener('input', () => {
        const pos = userIdInput.selectionStart;
        userIdInput.value = userIdInput.value.toUpperCase();
        userIdInput.setSelectionRange(pos, pos);
      });

      // Toggle password visibility
      const togglePassword = document.getElementById('togglePassword');
      const passwordInput = document.getElementById('password');
      const eyeIcon = document.getElementById('eyeIcon');

      togglePassword.addEventListener('click', () => {
        const type = passwordInput.type === 'password' ? 'text' : 'password';
        passwordInput.type = type;

        if (type === 'text') {
          eyeIcon.innerHTML = `
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
          `;
        } else {
          eyeIcon.innerHTML = `
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
          `;
        }
      });

      // Handle form submission
      const loginForm = document.getElementById('loginForm');
      const errorMessage = document.getElementById('errorMessage');
      const errorText = document.getElementById('errorText');
      const submitBtn = document.getElementById('submitBtn');

      loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        errorMessage.style.display = 'none';
        submitBtn.disabled = true;
        submitBtn.innerHTML = `
          <svg class="animate-spin" style="width:16px;height:16px;" fill="none" viewBox="0 0 24 24">
            <circle style="opacity:0.25;" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path style="opacity:0.75;" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Signing In...
        `;

        const data = {
          userId: userIdInput.value.trim(),
          password: document.getElementById('password').value,
        };

        try {
          const response = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
          });

          if (response.ok) {
            if (response.redirected) {
              window.location.href = response.url;
            } else {
              const result = await response.json();
              if (result.redirectUrl) {
                window.location.href = result.redirectUrl;
              }
            }
          } else {
            const result = await response.json();
            errorText.textContent = result.error || 'Invalid credentials. Please try again.';
            errorMessage.style.display = 'flex';
            submitBtn.disabled = false;
            submitBtn.innerHTML = `
              <svg style="width:16px;height:16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
              </svg>
              Sign In
            `;
          }
        } catch (error) {
          console.error('Login error:', error);
          errorText.textContent = 'An error occurred. Please try again.';
          errorMessage.style.display = 'flex';
          submitBtn.disabled = false;
          submitBtn.innerHTML = `
            <svg style="width:16px;height:16px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"/>
            </svg>
            Sign In
          `;
        }
      });
    </script>
  </body>
</html>
